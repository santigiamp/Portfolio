CREATE DATABASE techzone_full;
\c techzone_full;

-- CLIENTE
CREATE TABLE cliente (
    id_cliente SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    email VARCHAR(100),
    telefono VARCHAR(20),
    direccion TEXT
);

-- EMPLEADO
CREATE TABLE empleado (
    id_empleado SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    puesto VARCHAR(50),
    fecha_contratacion DATE
);

-- CATEGORIA
CREATE TABLE categoria (
    id_categoria SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL
);

-- PROVEEDOR
CREATE TABLE proveedor (
    id_proveedor SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    contacto VARCHAR(100),
    telefono VARCHAR(20),
    email VARCHAR(100)
);

-- PRODUCTO
CREATE TABLE producto (
    id_producto SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    precio DECIMAL(10,2) NOT NULL,
    stock INT DEFAULT 0,
    id_categoria INT REFERENCES categoria(id_categoria),
    id_proveedor INT REFERENCES proveedor(id_proveedor)
);

-- PEDIDO
CREATE TABLE pedido (
    id_pedido SERIAL PRIMARY KEY,
    fecha DATE NOT NULL,
    id_cliente INT REFERENCES cliente(id_cliente),
    id_empleado INT REFERENCES empleado(id_empleado),
    estado VARCHAR(20) DEFAULT 'Pendiente'
);

-- DETALLE PEDIDO
CREATE TABLE detalle_pedido (
    id_detalle SERIAL PRIMARY KEY,
    id_pedido INT REFERENCES pedido(id_pedido),
    id_producto INT REFERENCES producto(id_producto),
    cantidad INT NOT NULL,
    precio_unitario DECIMAL(10,2) NOT NULL
);

-- FACTURA
CREATE TABLE factura (
    id_factura SERIAL PRIMARY KEY,
    id_pedido INT UNIQUE REFERENCES pedido(id_pedido),
    fecha DATE NOT NULL,
    total DECIMAL(10,2) NOT NULL
);

-- PAGO
CREATE TABLE pago (
    id_pago SERIAL PRIMARY KEY,
    id_factura INT REFERENCES factura(id_factura),
    fecha DATE NOT NULL,
    monto DECIMAL(10,2) NOT NULL,
    metodo VARCHAR(50)
);

-- ENVÍO
CREATE TABLE envio (
    id_envio SERIAL PRIMARY KEY,
    id_pedido INT UNIQUE REFERENCES pedido(id_pedido),
    fecha_envio DATE,
    fecha_entrega DATE,
    estado VARCHAR(20)
);

-- ORDEN DE COMPRA
CREATE TABLE orden_compra (
    id_orden SERIAL PRIMARY KEY,
    id_proveedor INT REFERENCES proveedor(id_proveedor),
    fecha DATE NOT NULL,
    estado VARCHAR(20) DEFAULT 'Pendiente'
);

-- DETALLE DE ORDEN DE COMPRA
CREATE TABLE detalle_orden_compra (
    id_detalle SERIAL PRIMARY KEY,
    id_orden INT REFERENCES orden_compra(id_orden),
    id_producto INT REFERENCES producto(id_producto),
    cantidad INT NOT NULL,
    costo_unitario DECIMAL(10,2)
);


INSERT INTO categoria (id_categoria, nombre) VALUES 
(1, 'Laptops'),
(2, 'Periféricos'),
(3, 'Componentes');

INSERT INTO proveedor (id_proveedor, nombre, contacto, telefono, email) VALUES 
(1, 'Global Tech S.A.', 'Marta Gomez', '555-0101', 'ventas@globaltech.com'),
(2, 'Insumos PC', 'Roberto Diaz', '555-0202', 'contacto@insumospc.com');

INSERT INTO empleado (id_empleado, nombre, puesto, fecha_contratacion) VALUES 
(1, 'Ana Martinez', 'Vendedora Senior', '2022-03-15'),
(2, 'Carlos Ruiz', 'Gerente de Ventas', '2020-01-10');

INSERT INTO cliente (id_cliente, nombre, email, telefono, direccion) VALUES 
(1, 'Juan Perez', 'juan.perez@email.com', '111-2222', 'Av. Siempre Viva 123'),
(2, 'Maria Lopez', 'maria.lopez@email.com', '333-4444', 'Calle Falsa 456');

-- 2. Inventario y Compras (Dependen de Categoria y Proveedor)
INSERT INTO producto (id_producto, nombre, precio, stock, id_categoria, id_proveedor) VALUES 
(1, 'Laptop Dell XPS 13', 1500.00, 10, 1, 1),
(2, 'Mouse Logitech MX', 80.00, 50, 2, 2),
(3, 'Teclado Mecánico RGB', 120.00, 30, 2, 2),
(4, 'Monitor Samsung 24"', 200.00, 15, 2, 1),
(5, 'Procesador Intel i7', 400.00, 5, 3, 1);

INSERT INTO orden_compra (id_orden, id_proveedor, fecha, estado) VALUES 
(1, 2, '2023-10-01', 'Recibido');

INSERT INTO detalle_orden_compra (id_detalle, id_orden, id_producto, cantidad, costo_unitario) VALUES 
(1, 1, 2, 20, 40.00), -- Compramos mouse a 40, vendemos a 80
(2, 1, 3, 10, 60.00);

-- 3. Flujo de Ventas (Pedidos)
-- Pedido 1: Juan compra una Laptop y un Mouse. Atendido por Ana.
INSERT INTO pedido (id_pedido, fecha, id_cliente, id_empleado, estado) VALUES 
(1, '2023-10-15', 1, 1, 'Completado');

INSERT INTO detalle_pedido (id_detalle, id_pedido, id_producto, cantidad, precio_unitario) VALUES 
(1, 1, 1, 1, 1500.00),
(2, 1, 2, 1, 80.00);

-- Pedido 2: Maria compra un Monitor. Atendido por Carlos.
INSERT INTO pedido (id_pedido, fecha, id_cliente, id_empleado, estado) VALUES 
(2, '2023-10-20', 2, 2, 'En Proceso');

INSERT INTO detalle_pedido (id_detalle, id_pedido, id_producto, cantidad, precio_unitario) VALUES 
(3, 2, 4, 2, 200.00);

-- 4. Facturación, Pagos y Envíos (Dependen de Pedido)
-- Factura para el Pedido 1 (Total 1580)
INSERT INTO factura (id_factura, id_pedido, fecha, total) VALUES 
(1, 1, '2023-10-15', 1580.00);

INSERT INTO pago (id_pago, id_factura, fecha, monto, metodo) VALUES 
(1, 1, '2023-10-15', 1580.00, 'Tarjeta Crédito');

INSERT INTO envio (id_envio, id_pedido, fecha_envio, fecha_entrega, estado) VALUES 
(1, 1, '2023-10-16', '2023-10-18', 'Entregado');

-- Factura para el Pedido 2 (Total 400)
INSERT INTO factura (id_factura, id_pedido, fecha, total) VALUES 
(2, 2, '2023-10-20', 400.00);

-- Maria pagó solo la mitad por ahora
INSERT INTO pago (id_pago, id_factura, fecha, monto, metodo) VALUES 
(2, 2, '2023-10-20', 200.00, 'Efectivo');

-- El envío de Maria aun no sale
INSERT INTO envio (id_envio, id_pedido, fecha_envio, fecha_entrega, estado) VALUES 
(2, 2, NULL, NULL, 'Pendiente');